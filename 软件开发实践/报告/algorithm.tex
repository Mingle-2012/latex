\documentclass{article}
\usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algpseudocode}

\begin{document}

\begin{algorithm}
\caption{Main Exploration Loop with Expanded LLM Event Generation}
\begin{algorithmic}[1]
\Procedure{Start}{$\text{input\_manager}$}
  \State $count \gets 0$
  \While{$count < max\_event\_count$}
    \State Update UI state and snapshots
    \If{$count = 0$}
      \State $event \gets$ KillApp
    \ElsIf{$count = 1$}
      \State $event \gets$ StartIntent
    \ElsIf{$count \bmod events\_to\_restart = 0$}
      \State $event \gets$ ClearOrRestartApp
    \Else
      \If{LLM mode is active}
        \If{Continuing LLM Sequence}
          \State Build Next Action Prompt
          \State $response \gets$ CallLLM()
          \State $response \gets$ ValiditByLLM()
          \State $act \gets$ ParseAction(response)
        \Else
          \State Reset Message History
          \State Build Meaning Prompt
          \State $r_1 \gets$ CallLLM()
          \State Build Task Prompt
          \State $r_2 \gets$ CallLLM()
          \State Add Task Title from $r_2$
          \State Build First Action Prompt
          \State $r_3 \gets$ CallLLM()
          \State $response \gets$ ValiditByLLM()
          \State $act \gets$ ParseAction($r_3$)
        \EndIf
        \State Update LLM Mode: $in\_llm \gets act.hasNext$
        \State $event \gets$ WrapAsU2Event($act$)
      \ElsIf{Current UI $\approx$ Previous UI}
        \State Activate LLM Mode
        \State Follow same steps as above to generate $event$
      \Else
        \State $event \gets$ RandomGenerate(from\_state)
      \EndIf
    \EndIf
    \State Execute($event$); $count \gets count + 1$
  \EndWhile
  \State Clean up and exit
\EndProcedure
\end{algorithmic}
\end{algorithm}

\end{document}
